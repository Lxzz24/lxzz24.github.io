# **ä½¿ç”¨ Commons Logging**

å’Œ Java æ ‡å‡†åº“æä¾›çš„æ—¥å¿—ä¸åŒï¼Œ Commons Logging æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Œå®ƒæ˜¯ç”± Apache åˆ›å»ºçš„æ—¥å¿—æ¨¡å—ã€‚

Commons Logging çš„ç‰¹è‰²æ˜¯ï¼Œå®ƒå¯ä»¥æŒ‚æ¥ä¸åŒçš„æ—¥å¿—ç³»ç»Ÿï¼Œå¹¶é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæŒ‚æ¥çš„æ—¥å¿—ç³»ç»Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ Commons Loggin è‡ªåŠ¨æœç´¢å¹¶ä½¿ç”¨ Log4j ï¼ˆLog4j æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„æ—¥å¿—ç³»ç»Ÿï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ° Log4j ï¼Œå†ä½¿ç”¨ JDK Loggingã€‚

ä½¿ç”¨ Commons Logging åªéœ€è¦å’Œä¸¤ä¸ªç±»æ‰“äº¤é“ï¼Œå¹¶ä¸”åªæœ‰ä¸¤æ­¥ï¼š

- ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ `LogFactory` è·å– `Log` ç±»çš„å®ä¾‹ï¼› 
- ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ `Log` å®ä¾‹çš„æ–¹æ³•æ‰“æ—¥å¿—ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

public class Main {
    public static void main(String[] args) {
        Log log = LogFactory.getLog(Main.class);
        log.info("start...");
        log.warn("end.");
    }
}
```


è¿è¡Œä¸Šè¿°ä»£ç ï¼Œè‚¯å®šä¼šå¾—åˆ°ç¼–è¯‘é”™è¯¯ï¼Œç±»ä¼¼ `error: package org.apache.commons.logging does not exist`ï¼ˆæ‰¾ä¸åˆ° `org.apache.commons.logging` è¿™ä¸ªåŒ…ï¼‰ã€‚å› ä¸º Commons Logging æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æä¾›çš„åº“ï¼Œæ‰€ä»¥ï¼Œå¿…é¡»å…ˆæŠŠå®ƒ [ä¸‹è½½](https://commons.apache.org/proper/commons-logging/download_logging.cgi) ä¸‹æ¥ã€‚ä¸‹è½½åï¼Œè§£å‹ï¼Œæ‰¾åˆ° `commons-logging-1.2.jar` è¿™ä¸ªæ–‡ä»¶ï¼Œå†æŠŠ Java æºç  `Main.java` æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹ï¼Œä¾‹å¦‚ `work` ç›®å½•ï¼š

    work
    â”‚
    â”œâ”€ commons-logging-1.2.jar
    â”‚
    â””â”€ Main.java

ç„¶åç”¨ `javac` ç¼–è¯‘ `Main.java` ï¼Œç¼–è¯‘çš„æ—¶å€™è¦æŒ‡å®š `classpath` ï¼Œä¸ç„¶ç¼–è¯‘å™¨æ‰¾ä¸åˆ°æˆ‘ä»¬å¼•ç”¨çš„ `org.apache.commons.logging` åŒ…ã€‚ç¼–è¯‘å‘½ä»¤å¦‚ä¸‹ï¼š

```
javac -cp commons-logging-1.2.jar Main.java
```

å¦‚æœç¼–è¯‘æˆåŠŸï¼Œé‚£ä¹ˆå½“å‰ç›®å½•ä¸‹å°±ä¼šå¤šå‡ºä¸€ä¸ª `Main.class` æ–‡ä»¶ï¼š

    work
    â”‚
    â”œâ”€ commons-logging-1.2.jar
    â”‚
    â”œâ”€ Main.java
    â”‚
    â””â”€ Main.class

ç°åœ¨å¯ä»¥æ‰§è¡Œè¿™ä¸ª `Main.class` ï¼Œä½¿ç”¨ `java` å‘½ä»¤ï¼Œä¹Ÿå¿…é¡»æŒ‡å®š `classpath` ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```
java -cp .;commons-logging-1.2.jar Main
```

æ³¨æ„åˆ°ä¼ å…¥çš„ `classpath` æœ‰ä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯ `.` ï¼Œä¸€ä¸ªæ˜¯ `commons-logging-1.2.jar` ï¼Œç”¨ `;` åˆ†å‰²ã€‚ `.` è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ª `.` ï¼Œ JVM ä¸ä¼šåœ¨å½“å‰ç›®å½•æœç´¢ `Main.class` ï¼Œå°±ä¼šæŠ¥é”™ã€‚

å¦‚æœåœ¨ Linux æˆ– macOS ä¸‹è¿è¡Œï¼Œæ³¨æ„ `classpath` çš„åˆ†éš”ç¬¦ä¸æ˜¯ `;` ï¼Œè€Œæ˜¯ `:` ï¼š

```
java -cp .:commons-logging-1.2.jar Main
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```
Mar 02, 2019 7:15:31 PM Main main
INFO: start...
Mar 02, 2019 7:15:31 PM Main main
WARNING: end.
```

[ğŸ‘‰ ä½¿ç”¨ IDEA å¯çœ‹è¿™é‡Œ](#IDEAå¯¼å…¥jaråŒ…)

Commons Logging å®šä¹‰äº† 6 ä¸ªæ—¥å¿—çº§åˆ«ï¼š

- FATAL
- ERROR
- WARNING
- INFO
- DEBUG
- TRACE

é»˜è®¤çº§åˆ«æ˜¯ `INFO` ã€‚

ä½¿ç”¨ Commons Logging æ—¶ï¼Œå¦‚æœåœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨ `Log` ï¼Œé€šå¸¸ç›´æ¥å®šä¹‰ä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼š

```java
// åœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨ Log:
public class Main {
    static final Log log = LogFactory.getLog(Main.class);

    static void foo() {
        log.info("foo");
    }
}
```

åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨ `Log` ï¼Œé€šå¸¸å®šä¹‰ä¸€ä¸ªå®ä¾‹å˜é‡ï¼š

```java
// åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨ Log:
public class Person {
    protected final Log log = LogFactory.getLog(getClass());

    void foo() {
        log.info("foo");
    }
}
```


æ³¨æ„åˆ°å®ä¾‹å˜é‡ `log` çš„è·å–æ–¹å¼æ˜¯ `LogFactory.getLog(getClass())` ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ç”¨ `LogFactory.getLog(Person.class)` ï¼Œä½†æ˜¯å‰ä¸€ç§æ–¹å¼æœ‰ä¸ªéå¸¸å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯å­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ `log` å®ä¾‹ã€‚ä¾‹å¦‚ï¼š


```java
// åœ¨å­ç±»ä¸­ä½¿ç”¨çˆ¶ç±»å®ä¾‹åŒ–çš„ log:
public class Student extends Person {
    void bar() {
        log.info("bar");
    }
}
```


ç”±äº Java ç±»çš„åŠ¨æ€ç‰¹æ€§ï¼Œå­ç±»è·å–çš„ `log` å­—æ®µå®é™…ä¸Šç›¸å½“äº `LogFactory.getLog(Student.class)` ï¼Œä½†å´æ˜¯ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥ï¼Œå¹¶ä¸”æ— éœ€æ”¹åŠ¨ä»£ç ã€‚

æ­¤å¤–ï¼Œ Commons Logging çš„æ—¥å¿—æ–¹æ³•ï¼Œä¾‹å¦‚ `info()` ï¼Œé™¤äº†æ ‡å‡†çš„ `info(String)` å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é‡è½½æ–¹æ³•ï¼š `info(String, Throwable)` ï¼Œè¿™ä½¿å¾—è®°å½•å¼‚å¸¸æ›´åŠ ç®€å•ï¼š


```java
try {
    ...
} catch (Exception e) {
    log.error("got exception!", e);
}
```


## IDEA å¯¼å…¥ jar åŒ…

1ã€Java é¡¹ç›®åœ¨æ²¡æœ‰å¯¼å…¥è¯¥ jar åŒ…ä¹‹å‰ï¼Œå¦‚å›¾ï¼š

![20220624153657](assets/20220624153657.png)


2ã€ç‚¹å‡» File ->  Project Structure ï¼Œç‚¹å‡» Project Structure ç•Œé¢å·¦ä¾§çš„ Modules 

![20220624154013](assets/20220624154013.png)


3ã€åœ¨ â€œDependenciesâ€ æ ‡ç­¾ç•Œé¢ä¸‹ï¼Œç‚¹å‡» â€œ+â€ å·ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªé€‰é¡¹ â€œJARs or directories...â€ï¼Œé€‰æ‹©ç›¸åº”çš„ jar åŒ…ï¼Œç‚¹ â€œOKâ€ ï¼Œ jar åŒ…æ·»åŠ æˆåŠŸ


![20220624154249](assets/20220624154249.png)


4ã€ç‚¹ â€œOKâ€ å›åˆ°é¡¹ç›®ç•Œé¢ï¼Œ IntelliJ IDEA è‡ªåŠ¨æç¤ºéœ€è¦æ·»åŠ  `import` è¯­å¥ï¼Œå¿«é€Ÿæ·»åŠ  `import` è¯­å¥ä¹‹åï¼Œé¡¹ç›®æˆåŠŸç¼–è¯‘

![20220624154349](assets/20220624154349.png)

![20220624154744](assets/20220624154744.png)


## ç»ƒä¹ 

ä½¿ç”¨ `log.error(String, Throwable)` æ‰“å°å¼‚å¸¸ã€‚

```java
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import java.io.UnsupportedEncodingException;

public class CommonLogTest {
    static final Log log = LogFactory.getLog(CommonLogTest.class);

    public static void main(String[] args) {
        log.info("Start process...");
        try {
            "".getBytes("invalidCharsetName");
        } catch (UnsupportedEncodingException e) {
            // TODO: ä½¿ç”¨log.error(String, Throwable)æ‰“å°å¼‚å¸¸
            log.error("invalid charset name", e);
        }
        log.info("Process end.");
    }
}
```


```
6æœˆ 24, 2022 3:53:48 ä¸‹åˆ javase.test.d.work.CommonLogTest main
ä¿¡æ¯: Start process...
6æœˆ 24, 2022 3:53:48 ä¸‹åˆ javase.test.d.work.CommonLogTest main
ä¸¥é‡: invalid charset name
java.io.UnsupportedEncodingException: invalidCharsetName
	at java.base/java.lang.String.lookupCharset(String.java:819)
	at java.base/java.lang.String.getBytes(String.java:1763)
	at javase.test.d.work.CommonLogTest.main(CommonLogTest.java:20)

6æœˆ 24, 2022 3:53:48 ä¸‹åˆ javase.test.d.work.CommonLogTest main
ä¿¡æ¯: Process end.
```

## å°ç»“

- Commons Logging æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„æ—¥å¿—æ¨¡å—ï¼›
- Commons Logging çš„ API éå¸¸ç®€å•ï¼›
- Commons Logging å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨å…¶ä»–æ—¥å¿—æ¨¡å—ã€‚



